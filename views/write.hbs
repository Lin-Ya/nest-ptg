<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>{{ title }}</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/public/layui/css/layui.css">
    <link rel="stylesheet" href="/public/styles/index.css">
    <link rel="stylesheet" href="/public/simpleMDE/simplemde.min.css">
    <link rel="stylesheet" href="/public/styles/github-markdown.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/highlight.js/latest/styles/github.min.css">
</head>

<body>
    <div class="layui-layout layui-layout-admin">
        {{> header}}
        <div class="markdown-container">
            <div class="markdown-form">
                <form class="layui-form">
                    <div class="layui-form-item">
                        <label class="layui-form-label">标题</label>
                        <div class="layui-input-block">
                            <input type="text" name="Title" required lay-verify="required" placeholder="请输入标题"
                                autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">Tags</label>
                        <div class="layui-input-block">
                            <input type="text" name="Tags" required lay-verify="required" placeholder="请输入Tags"
                                autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">专集</label>
                        <div class="layui-input-block">
                            <select name="collect" lay-verify="required">
                                <option value="default">default</option>
                                <option value="test">test</option>
                                <option value="nest">nest.js</option>
                                <option value="react">react</option>
                                <option value="vue">vue</option>
                                <option value="javascript">javascript</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-form-item layui-form-text">
                        <label class="layui-form-label">简介</label>
                        <div class="layui-input-block">
                            <textarea name="Description" placeholder="请输入内容" class="layui-textarea"></textarea>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-input-block">
                            <button type="button" class="layui-btn" lay-submit lay-filter="FormOne">创建</button>
                            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="markdown-area">
                <textarea name="MyID" id="MyID" cols="30" rows="10"></textarea>
            </div>
        </div>
    </div>
    <script src="/public/layui/layui.js"></script>
    <script src="/public/simpleMDE/simplemde.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/highlight.js/latest/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.js"></script>
    <script>
        window.onload = function () {
            init();
        }

        function init() {
            addLayui();
            var mdInstance = addMarkdown();
            addHandleEvent(mdInstance);
        }

        function addLayui() {
            layui.use('element', function () {
                var element = layui.element;
            });
        }

        function addMarkdown() {
            var simplemde = new SimpleMDE({
                autofocus: true,
                autosave: {
                    enabled: true,
                    uniqueId: "MyUniqueID",
                    delay: 1000,
                },
                element: document.getElementById("MyID"),
                placeholder: "Type here...",
                renderingConfig: {
                    codeSyntaxHighlighting: true
                }
            });

            return simplemde;

            // console.log(simplemde.value())
            // console.log(simplemde.markdown(simplemde.value()))
        }

        function addHandleEvent(md) {
            layui.use('form', function () {
                var form = layui.form;

                form.on('submit(FormOne)', function (data) {
                    // layer.msg(JSON.stringify(data.field));

                    var newData = Object.assign({}, data.field, {
                        markdown: md.value(),
                        html: md.markdown(md.value())
                    })

                    axios({
                        method: 'post',
                        url: '/write/create',
                        data: newData,
                    }).then(function (response) {
                        console.log(response);
                        layer.msg('创建成功');
                    }).catch(function (error) {
                        console.log(error);
                        layer.msg("创建失败");
                    });

                    return false;
                });
            });
        }
    </script>

</html>